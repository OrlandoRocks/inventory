(function(){var c,_,p,u;$(window).bind("page:change",function(){var e,n,a,d,l,t,i,r,o,s,m;window.deparments_filtered=[],window.deparment_selected="",window.code_selected="",window.isEdit=!1,$("#immediate_boss").text("Admin"),$("#maintenanceModal").on("shown.bs.modal",function(e){var n;n=$(e.relatedTarget).data("item-id"),console.log(n),$(e.currentTarget).find(".modal-title").text(I18n.maintenance),$(e.currentTarget).find("#items_maintenance_item_id").val(n)}),$("#saveMaintenance").on("click",function(){var e,n;e={items_maintenance:{maintenance_id:(n=$("form#maintenance-form")).find("#items_maintenance_maintenance_id").val(),description:n.find("#items_maintenance_description").val(),price:n.find("#items_maintenance_price").val(),provider:n.find("#items_maintenance_provider").val(),item_id:n.find("#items_maintenance_item_id").val()}},$.ajax({method:"POST",url:n.attr("action"),data:e,success:function(){return $("#maintenanceModal").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove()},error:function(){return swal(I18n.general_error,I18n.try_again,"error")}})}),$("#reporter_form").submit(function(e){var n;n=$(this),e.preventDefault(),$.ajax({method:"GET",url:"/reporter.js",data:n.serialize(),success:function(){return unblock()}})}),$("#reporter-list").on("click",".paging_simple_numbers a",function(){return $.getScript(this.href),!1}),""!==(m=$("#q_branch_id_in")).val()&&(o=m.val(),s=$("#q_department_id_in").val(),$("#q_department_id_in").html(""),o&&c(o,s)),m.change(function(){var e,n;s=null!=(n=""===$("#q_department_id_in").val())?n:{"null":$("#q_department_id_in").val()},e=$(this),c(e.val(),s)}),t=$("#item_branch_id"),d=$("#item_department_id"),r=$("#user_id"),l=$("#immediate_boss"),a=$("#item_code"),n=$("#category_id"),(e=$("#item_sub_category_id")).prop("disabled",!0),i=$("#item_user_id"),t.change(function(){var e,n;e=$(this),n=$.parseJSON($("#director_name").val()),""===e.val()?((r=$("#item_user_id")).html(""),r.append(new Option(n.full_name.concat(" - Director"),n.id)),$("#immediate_boss").text("Admin"),d.html("")):_(e.val(),null)}),""!==t.val()&&_(t.val(),d.val()),d.change(function(){var e;""!==(e=$(this)).val()?(window.isEdit=!1,u(e.val(),!1)):_(t.val(),null)}),""!==d.val()&&(window.isEdit=!0,window.deparment_selected=d.val(),window.code_selected=a.val(),u(d.val(),!0)),i.change(function(){var e,n,a,t,i,r;for(e=$(this),a=$("#item_user_id option:first").val(),$("#user_id").val(e.val()),t=0,i=(r=window.deparments_filtered).length;t<i;t++)if(n=r[t],parseInt(n.id)===parseInt(d.val()))return void(parseInt(a)===parseInt(e.val())?l.text(n.branch.user.full_name):l.text(n.manager.first_name+" "+n.manager.last_name))}),n.change(function(){$(this),p(n.val(),null)}),""!==n.val()&&p(n.val(),e.val())}),u=function(e,n){var a,t,i,r,d,l,o,s,m,c,_,p,u,v,f,h,g;if(d=$("#item_user_id"),a=$("#item_code"),t=$("#item_code2"),i=$("#immediate_boss"),r=$("#immediate_boss_id"),a.prop("disabled",!0),{},""===e);else for(d.html(""),c=0,p=(v=window.deparments_filtered).length;c<p;c++)if(l=v[c],parseInt(l.id)===parseInt(e)){for(l.manager&&(g=l.manager.first_name+" "+l.manager.last_name.concat(" - Coordinador"),d.append(new Option(g,l.manager.id)),m=$("#item_user_id option:first").val()),_=0,u=(f=l.employees).length;_<u;_++)o=(s=f[_]).first_name+" "+s.last_name.concat(" - Empleado Responsable"),d.append(new Option(o,s.id));return l.manager&&(r.val(l.manager.id),i.text(l.branch.user.full_name)),window.isEdit||(h=l.last_code?parseInt(l.last_code.slice(-4))+1:l.sequence,window.deparment_selected===e?(a.val(window.code_selected),t.val(window.code_selected)):null===l.branch.code||null===l.code?a.val("Sin Codigo"):(a.val(l.branch.code+"-"+l.code+"-"+("000"+h).slice(-4)),t.val(l.branch.code+"-"+l.code+"-"+("000"+h).slice(-4)))),void(""!==d.val()&&n&&(m=$("#item_user_id option:first").val(),parseInt(m)===parseInt($("#user_id").val())?i.text(l.branch.user.full_name):i.text(l.manager.first_name+" "+l.manager.last_name)))}},_=function(e,r){var n,a,d,t,l,o,i,s;t=$("#immediate_boss"),d=$("#item_department_id"),o=$("#user_id"),l=$("#item_user_id"),n=$("#item_code"),a=$("#item_code2"),null===r&&(n.val(""),a.val(""),n.prop("disabled",!0)),d.prop("disabled",!1),s=d.val(),null!=(i=$.parseJSON($("#director_name").val()))&&t.text(i.full_name),""!==e?$.ajax({type:"GET",url:"/branches/"+e+"/departments",success:function(e){var n,a,t,i;for(window.deparments_filtered=e,d.html(""),l.html(""),i=e[0].branch.user.full_name.concat(" - Gerente"),$("<option>").val("").text("Seleccionar...").appendTo(d),l.append(new Option(i,e[0].branch.user.id)),a=0,t=e.length;a<t;a++)n=e[a],d.append(new Option(n.name,n.id));null!==r&&($('#item_department_id option[value="'+s+'"]').attr("selected",!0),u(r,!0),$('#item_user_id option[value="'+o.val()+'"]').attr("selected",!0))}}):d.html("")},c=function(e,m){null!==e?$.ajax({method:"GET",url:"/branches/departments/",data:{branch_ids:e},success:function(e){var n,a,t,i,r,d,l,o,s;for($("#q_department_id_in").html(""),t=0,r=e.length;t<r;t++){for((n=e[t]).id,n.name,(l=$("<optgroup>")).attr("label",n.name),i=0,d=(s=n.departments).length;i<d;i++)a=s[i],(o=$("<option></option>")).val(a.id),o.text(a.name),l.append(o);$("#q_department_id_in").append(l)}if(null!==m)return $("#q_department_id_in").val(m),void $(".select2").select2({theme:"classic"})}}):$("#q_department_id_in").html("")},p=function(e,r){var d;d=$("#item_sub_category_id"),null!==e?$.ajax({method:"GET",url:"/categories/sub_categories/",data:{category_ids:e},success:function(e){var n,a,t,i;for(d.prop("disabled",!1),d.html(""),n=0,a=(t=e.sub_categories).length;n<a;n++)i=t[n],d.append(new Option(i.name,i.id));null===r||d.val(r)}}):d.html("")}}).call(this);